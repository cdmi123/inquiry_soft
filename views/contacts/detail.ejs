<%- include('../partials/header') %>
<div class="row">
  <div class="col-12 col-lg-8">
    <!-- Contact Card -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h1 class="mb-0 h4"><%= contact.name %></h1>
        <a href="/" class="btn btn-sm btn-light">‚Üê Back</a>
      </div>
      <div class="card-body">
        <div class="row mb-3">
          <div class="col-sm-6 mb-3 mb-sm-0">
            <small class="text-muted d-block mb-1">Phone</small>
            <a href="tel:<%= contact.phone %>" class="text-decoration-none fs-5"><%= contact.phone %></a>
          </div>
          <div class="col-sm-6">
            <small class="text-muted d-block mb-1">Last Call</small>
            <p class="mb-0"><%= contact.lastCallAt ? new Date(contact.lastCallAt).toLocaleString() : '-' %></p>
          </div>
        </div>
        
        <% if (contact.description) { %>
          <hr>
          <div class="mb-3">
            <small class="text-muted d-block mb-2">Description</small>
            <p class="mb-0"><%= contact.description %></p>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="d-grid gap-2 d-md-flex mb-4">
      <button class="btn btn-primary btn-lg call-btn" data-id="<%= contact._id %>" data-phone="<%= contact.phone %>">
        üìû Call Now
      </button>
      <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#noteModal">
        ‚ûï Add Note
      </button>
      <a href="/" class="btn btn-outline-secondary btn-lg">All Contacts</a>
    </div>

    <!-- Notes Section -->
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h5 class="mb-0">Notes (<%= notes.length %>)</h5>
      </div>
      <% if (notes.length === 0) { %>
        <div class="card-body text-center text-muted py-5">
          <p class="mb-0">No notes yet. Click "Add Note" to create one.</p>
        </div>
      <% } else { %>
        <ul class="list-group list-group-flush">
          <% notes.forEach(function(n) { %>
            <li class="list-group-item py-3">
              <p class="mb-2"><%= n.noteText %></p>
              <small class="text-muted">
                üìÖ <% var date = new Date(n.createdAt); %><%= date.toLocaleDateString() %> at <%= date.toLocaleTimeString() %>
              </small>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>
  </div>
</div>

<!-- Note Modal -->
<div class="modal fade" id="noteModal" tabindex="-1" aria-labelledby="noteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <form id="noteForm" class="modal-content">
      <div class="modal-header border-bottom">
        <h5 class="modal-title" id="noteModalLabel">Add New Note</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label" for="noteText">Note <span class="text-danger">*</span></label>
          <textarea id="noteText" name="noteText" class="form-control" rows="5" placeholder="Enter your note here..." required></textarea>
        </div>
      </div>
      <div class="modal-footer border-top">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-success" type="submit">Save Note</button>
      </div>
    </form>
  </div>
</div>

<script>
window.currentContactId = "<%= contact._id %>";
</script>

<%- include('../partials/footer') %>
