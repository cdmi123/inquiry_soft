<%- include('../partials/header') %>
<div class="mb-4">
  <div class="row align-items-center g-2">
    <div class="col-12 col-sm-auto">
      <h1 class="mb-0">Contacts</h1>
    </div>
    <div class="col-12 col-sm-auto ms-sm-auto">
      <button id="syncBtn" class="btn btn-success w-100 w-sm-auto">ðŸ“¥ Import From Google Sheet</button>
    </div>
  </div>
</div>

<!-- Desktop Table View -->
<div class="d-none d-lg-block">
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-light">
        <tr>
          <th>Name</th>
          <th>Phone</th>
          <th>Last Call</th>
          <th>Notes</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
      <% contacts.forEach(function(c){ %>
        <tr>
          <td><a href="/contacts/<%= c._id %>" class="text-decoration-none"><strong><%= c.name %></strong></a></td>
          <td><a href="tel:<%= c.phone %>" class="text-decoration-none"><%= c.phone %></a></td>
          <td><small><%= c.lastCallAt ? new Date(c.lastCallAt).toLocaleString() : '-' %></small></td>
          <td><span class="badge bg-info"><%= c.notesCount || 0 %></span></td>
          <td class="text-center">
            <button class="btn btn-sm btn-primary call-btn" data-id="<%= c._id %>" data-phone="<%= c.phone %>" title="Call">ðŸ“ž</button>
            <a class="btn btn-sm btn-outline-secondary" href="/contacts/<%= c._id %>" title="Details">View</a>
          </td>
        </tr>
      <% }) %>
      </tbody>
    </table>
  </div>
</div>

<!-- Mobile List View -->
<div class="d-lg-none">
  <ul class="list-group list-group-flush">
    <% contacts.forEach(function(c){ %>
      <li class="list-group-item">
        <div class="d-flex justify-content-between align-items-start">
          <div class="flex-grow-1">
            <h6 class="mb-1">
              <a href="/contacts/<%= c._id %>" class="text-decoration-none"><%= c.name %></a>
            </h6>
            <p class="mb-1">
              <small class="text-muted">ðŸ“ž</small>
              <a href="tel:<%= c.phone %>" class="text-decoration-none"><small><%= c.phone %></small></a>
            </p>
            <% if (c.lastCallAt) { %>
              <p class="mb-1">
                <small class="text-muted">Last: <%= new Date(c.lastCallAt).toLocaleDateString() %></small>
              </p>
            <% } %>
            <span class="badge bg-info"><%= c.notesCount || 0 %> notes</span>
          </div>
          <div class="ms-2">
            <button class="btn btn-sm btn-primary call-btn" data-id="<%= c._id %>" data-phone="<%= c.phone %>" title="Call">ðŸ“ž</button>
            <a class="btn btn-sm btn-outline-secondary" href="/contacts/<%= c._id %>" title="Details">â†’</a>
          </div>
        </div>
      </li>
    <% }) %>
  </ul>
</div>

<% if (contacts.length === 0) { %>
  <div class="alert alert-info text-center py-4">
    <p class="mb-0">No contacts yet. <a href="/contacts/add" class="alert-link">Add one now!</a></p>
  </div>
<% } %>

<%- include('../partials/footer') %>
